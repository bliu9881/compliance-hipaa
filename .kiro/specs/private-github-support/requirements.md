# Requirements Document: Private GitHub Repository Support

## Introduction

GuardPHI currently only supports scanning public GitHub repositories. This feature adds support for private repositories by allowing users to authenticate with GitHub using a personal access token (PAT). This enables healthcare teams to scan their private codebases for HIPAA compliance issues.

## Glossary

- **GitHub Token**: A personal access token (PAT) generated by a GitHub user with `repo` scope permissions to access private repositories
- **Token Storage**: Session storage mechanism to temporarily hold the token during the user's session without persisting to disk
- **Scanner**: The component that handles GitHub repository scanning
- **API Call**: HTTP request to GitHub API endpoints for repository data
- **Authentication Header**: HTTP Authorization header containing the GitHub token for API authentication

## Requirements

### Requirement 1: GitHub Token Input Interface

**User Story:** As a developer with a private GitHub repository, I want to provide a GitHub personal access token, so that I can scan my private repositories for HIPAA compliance.

#### Acceptance Criteria

1. WHEN the user is on the GitHub scanning tab THEN the Scanner SHALL display an optional GitHub token input field below the repository URL field
2. WHEN the user enters a GitHub token THEN the Scanner SHALL accept tokens in the format of GitHub personal access tokens (40+ alphanumeric characters)
3. WHEN the user provides a token THEN the Scanner SHALL store it in session storage (not localStorage) for the duration of the session
4. WHEN the user clears the token input field THEN the Scanner SHALL remove the token from session storage
5. WHEN the user refreshes the page THEN the Scanner SHALL clear the stored token from session storage (session-only storage)

### Requirement 2: Token Usage in GitHub API Calls

**User Story:** As a developer, I want my GitHub token to be used for all API calls, so that I can access private repository data.

#### Acceptance Criteria

1. WHEN a GitHub token is stored in session THEN the Scanner SHALL include the token in the Authorization header for all GitHub API calls
2. WHEN fetching commit information THEN the API call SHALL include the Authorization header with the token
3. WHEN fetching repository contents THEN the API call SHALL include the Authorization header with the token
4. WHEN downloading file content THEN the API call SHALL include the Authorization header with the token
5. WHEN no token is provided THEN the Scanner SHALL make unauthenticated API calls (for public repos)

### Requirement 3: Enhanced Error Handling for Private Repos

**User Story:** As a developer, I want clear error messages when authentication fails, so that I can troubleshoot access issues.

#### Acceptance Criteria

1. WHEN a private repository is accessed without a token THEN the Scanner SHALL display an error message: "Repository is private. Please provide a GitHub personal access token to scan private repositories."
2. WHEN an invalid or expired token is provided THEN the Scanner SHALL display an error message: "GitHub authentication failed. Please verify your token is valid and has 'repo' scope permissions."
3. WHEN a token lacks required permissions THEN the Scanner SHALL display an error message: "Your GitHub token does not have required permissions. Please ensure it has 'repo' scope."
4. WHEN the user lacks access to a repository THEN the Scanner SHALL display an error message: "You do not have access to this repository. Please verify the URL and your token permissions."
5. WHEN authentication succeeds THEN the Scanner SHALL proceed with the scan without displaying authentication errors

### Requirement 4: Token Security and Privacy

**User Story:** As a security-conscious developer, I want my GitHub token to be handled securely, so that my credentials are not exposed or persisted.

#### Acceptance Criteria

1. WHEN a token is provided THEN the Scanner SHALL store it only in session storage (cleared on page refresh)
2. WHEN displaying the token input field THEN the Scanner SHALL mask the token input (type="password" or similar)
3. WHEN the token is stored THEN the Scanner SHALL NOT log the token to console or send it to external services
4. WHEN the user closes the browser tab THEN the Scanner SHALL clear the token from memory
5. WHEN the scan completes THEN the Scanner SHALL NOT include the token in saved scan results or Supabase

### Requirement 5: User Guidance for Token Creation

**User Story:** As a new user, I want clear instructions on how to create a GitHub token, so that I can quickly set up private repo scanning.

#### Acceptance Criteria

1. WHEN the user sees the token input field THEN the Scanner SHALL display a help text or link explaining how to create a GitHub personal access token
2. WHEN the user clicks the help link THEN the Scanner SHALL open GitHub's token creation documentation in a new tab
3. WHEN the user hovers over the token input THEN the Scanner SHALL display a tooltip with required token scopes ("repo" scope minimum)
4. WHEN the user provides an invalid token format THEN the Scanner SHALL display a validation message: "Token should be 40+ characters"

### Requirement 6: Backward Compatibility

**User Story:** As an existing user, I want the app to continue working with public repositories, so that my workflow is not disrupted.

#### Acceptance Criteria

1. WHEN no token is provided THEN the Scanner SHALL scan public repositories as before
2. WHEN a public repository URL is provided THEN the Scanner SHALL NOT require a token
3. WHEN the user toggles between public and private repos THEN the Scanner SHALL maintain the token input state
4. WHEN the incremental check feature is used THEN the Scanner SHALL work with both public and private repos using the same token

